<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>SMOOTHY — demo</title>
<style>
  :root{
    --page-bg:#0e0e12;
    --card-bg:#17171f;
    --card-w: 560px;
    --card-h: 680px;
    --radius: 22px;
    --gap: 56px;
    --max-tilt: 16deg;       /* ← más “dramático” que antes */
    --glow: 0 30px 120px rgba(0,0,0,.55);
    --rail-hpad: 10vw;
    --accent: #ff5fd2;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;background:var(--page-bg);
    color:#d6d6de;font:15px/1.3 Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
    -webkit-font-smoothing:antialiased;overflow:hidden;
  }
  header{
    position:fixed;left:24px;top:18px;z-index:60;color:#fafafa;
    font-weight:700;letter-spacing:.04em;display:flex;gap:18px;align-items:center;
  }
  header .hint{font-weight:500;opacity:.7}
  header b{letter-spacing:.08em}
  .wrap{position:fixed;inset:0;display:grid;place-items:center}
  .viewport{width:100%;height:100%;position:relative;display:flex;flex-direction:column;gap:16px}
  .rail{
    position:relative;flex:1;display:block;
    padding: 12vh var(--rail-hpad);
    touch-action:none;cursor:grab;
  }
  .stage{
    position:relative;height:100%;display:flex;gap:var(--gap);will-change:transform;
  }
  .stage.grabbing{cursor:grabbing}
  /* CARD */
  .card{
    width:var(--card-w);height:var(--card-h);border-radius:var(--radius);
    background:linear-gradient(180deg,#1b1b24 0%,#121219 100%);
    box-shadow: var(--glow);
    position:relative;overflow:hidden;flex:0 0 auto;
    transform-style:preserve-3d;perspective:1000px;
    transition:filter .2s ease;
  }
  .card.is-center{filter:brightness(1.02)}
  .pad{position:absolute;inset:0;border-radius:inherit;pointer-events:none}
  .card .num{
    position:absolute;left:18px;top:16px;z-index:5;font:700 12px/1 ui-monospace,Menlo,Consolas,monospace;
    letter-spacing:.35em;color:#8b8b95;opacity:.65
  }
  .layer{
    position:absolute;inset:0;transform-style:preserve-3d;will-change:transform;
  }
  .img{
    position:absolute;left:0;top:0;width:100%;height:100%;object-fit:cover;border-radius:inherit;
    pointer-events:none;
  }
  /* Mid (fondo): un poco de Z */
  .img.mid{transform:translateZ(18px) scale(1.02);filter:blur(.1px) saturate(.95)}
  /* FG (principal): más Z y más grande */
  .img.fg{transform:translateZ(72px) scale(1.10)}
  /* Glow suave arriba-abajo para “card” */
  .card::after{
    content:"";position:absolute;inset:-20% -15% auto -15%;height:65%;
    background:radial-gradient(60% 80% at 50% 30%,rgba(255,255,255,.12),transparent 60%);
    transform:translateZ(100px);border-radius:40%;
    pointer-events:none;opacity:.35;mix-blend-mode:screen;
  }
  /* Footer botón */
  .chip{
    position:absolute;left:50%;bottom:18px;transform:translate(-50%,0) translateZ(110px);
    background:rgba(255,255,255,.12);backdrop-filter:blur(8px);
    color:#f5f5ff;padding:8px 14px;border-radius:999px;font-weight:700;letter-spacing:.02em;font-size:14px;
    box-shadow:0 6px 14px rgba(0,0,0,.25)
  }
  /* Barra de progreso */
  .progress{
    height:8px;border-radius:8px;background:#191922;margin:0 var(--rail-hpad) 10px;position:relative;overflow:hidden
  }
  .bar{position:absolute;height:100%;left:0;top:0;width:20%;background:#3a3a46;border-radius:inherit}
  .thumb{position:absolute;inset:0;background:linear-gradient(90deg,#5556,#9998);transform-origin:left center}
  /* Flechas */
  .arrows{position:fixed;right:28px;bottom:24px;display:flex;gap:14px;z-index:50}
  .btn{
    width:44px;height:44px;border-radius:999px;background:#14141b;color:#d8d8e6;border:1px solid #2c2c38;
    display:grid;place-items:center;cursor:pointer;user-select:none
  }
  .btn:hover{background:#191926}
  .btn:active{transform:translateY(1px)}
  .btn svg{width:18px;height:18px}
  /* Dots */
  .dots{position:fixed;left:50%;bottom:18px;transform:translateX(-50%);display:flex;gap:10px;z-index:20}
  .dot{width:8px;height:8px;border-radius:50%;background:#7b7b86}
  .dot.is-on{background:#fff}

  /* Responsivo */
  @media (max-width: 1200px){
    :root{ --card-w: 440px; --card-h: 560px; --gap: 42px; }
    .rail{padding: 12vh 8vw}
    header{left:18px}
  }
  @media (max-width: 850px){
    :root{ --card-w: 84vw; --card-h: min(70vh,560px); --gap: 28px; --rail-hpad: 6vw; }
    .arrows{right:16px}
  }
</style>
</head>
<body>
  <header>
    <b>SMOOTHY</b>
    <div class="hint">Arrastra / flechas → Inercia + loop + tilt 3D + parallax</div>
  </header>

  <div class="wrap">
    <div class="viewport">
      <div class="rail" id="rail">
        <div class="stage" id="stage" aria-label="carrusel"></div>
      </div>

      <div class="progress"><div class="bar" id="bar"><div class="thumb" id="thumb"></div></div></div>

      <div class="arrows">
        <div class="btn" id="prev" title="Anterior" aria-label="Anterior">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M15 19l-7-7 7-7" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
        </div>
        <div class="btn" id="next" title="Siguiente" aria-label="Siguiente">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M9 5l7 7-7 7" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
        </div>
      </div>

      <div class="dots" id="dots" aria-label="paginación"></div>
    </div>
  </div>

<script>
/* ---------- DATA: usa tus imágenes en /assets ---------- */
const slides = [
  { n:'0001', label:'Visión',    mid:'assets/vision-mid.png',    fg:'assets/vision-fg.png' },
  { n:'0002', label:'Escucha',   mid:'assets/escucha-mid.png',   fg:'assets/escucha-fg.png' },
  { n:'0003', label:'Olfato',    mid:'assets/olfato-mid.png',    fg:'assets/olfato-fg.png' },
  { n:'0004', label:'Sabor',     mid:'assets/sabor-mid.png',     fg:'assets/sabor-fg.png' },
  { n:'0005', label:'Tacto',     mid:'assets/tacto-mid.png',     fg:'assets/tacto-fg.png' },
  { n:'0006', label:'Equilibrio',mid:'assets/equilibrio-mid.png',fg:'assets/equilibrio-fg.png' },
];

/* ---------- Build DOM ---------- */
const stage = document.getElementById('stage');
const rail  = document.getElementById('rail');
const dots  = document.getElementById('dots');

function makeCard(s){
  const card = document.createElement('article');
  card.className = 'card';
  card.innerHTML = `
    <div class="num">${s.n}</div>
    <div class="layer">
      <img class="img mid" src="${s.mid}" alt="${s.label} fondo" loading="lazy" />
      <img class="img fg"  src="${s.fg}"  alt="${s.label}" loading="lazy" />
    </div>
    <div class="chip">${s.label}</div>
    <div class="pad"></div>
  `;
  attachTilt(card);
  return card;
}

/* clonado para loop infinito */
const all = [...slides, ...slides, ...slides];
all.forEach(s => stage.appendChild(makeCard(s)));

/* ---------- Slider con inercia + loop ---------- */
let x = 0, v = 0, dragging = false, lastX = 0, lastT = 0;
const cardW = () => stage.querySelector('.card').offsetWidth;
const gap   = parseFloat(getComputedStyle(stage).getPropertyValue('--gap')) || 56;
const unit  = () => cardW() + gap;
const total = () => unit()*all.length;

function posMod(n, m){ return ((n%m)+m)%m }

function setX(nx){
  x = posMod(nx, total());
  stage.style.transform = `translate3d(${-x}px,0,0)`;
  updateCenter();
  updateProgress();
}

function onPointerDown(e){
  dragging = true; stage.classList.add('grabbing');
  lastX = e.clientX ?? e.touches?.[0].clientX;
  lastT = performance.now();
}
function onPointerMove(e){
  const now = performance.now();
  const cx = e.clientX ?? e.touches?.[0].clientX;
  if(dragging){
    const dx = (lastX - cx);
    const dt = Math.max(16, now - lastT);
    v = (dx/dt)*16; // px/frame
    setX(x + dx);
    lastX = cx; lastT = now;
  }
}
function onPointerUp(){
  dragging = false; stage.classList.remove('grabbing');
}
rail.addEventListener('mousedown', onPointerDown);
rail.addEventListener('touchstart', onPointerDown,{passive:true});
window.addEventListener('mousemove', onPointerMove,{passive:false});
window.addEventListener('touchmove', onPointerMove,{passive:false});
window.addEventListener('mouseup', onPointerUp);
window.addEventListener('touchend', onPointerUp);

/* inercia */
function tick(){
  if(!dragging){
    if(Math.abs(v) > .02){ setX(x + v); v *= .94; }
  }
  requestAnimationFrame(tick);
}
tick();

/* botones */
document.getElementById('prev').onclick = () => { v = 0; setX(x - unit()); };
document.getElementById('next').onclick = () => { v = 0; setX(x + unit()); };

/* dots */
for(let i=0;i<slides.length;i++){
  const d=document.createElement('div'); d.className='dot'; dots.appendChild(d);
}
function updateDots(idx){
  [...dots.children].forEach((el,i)=> el.classList.toggle('is-on', i===idx));
}

/* cuál está centrada */
function updateCenter(){
  const u = unit(), mid = (x + (rail.clientWidth/2) - parseFloat(getComputedStyle(rail).paddingLeft))/u;
  const centerIdx = posMod(Math.round(mid), slides.length);
  updateDots(centerIdx);

  // marcar .is-center para un pelín de brillo
  const cards = stage.querySelectorAll('.card');
  cards.forEach((c,i)=>{
    const left = i*u - x + parseFloat(getComputedStyle(rail).paddingLeft);
    const cx = left + cardW()/2;
    const dist = Math.abs(cx - rail.clientWidth/2);
    c.classList.toggle('is-center', dist < u*0.35);
  });
}

/* barra de progreso */
const bar  = document.getElementById('bar');
const th   = document.getElementById('thumb');
function updateProgress(){
  const p = (x % (slides.length*unit()))/(slides.length*unit()); // 0..1
  th.style.transform = `translateX(${p*100}%)`;
}

/* ---------- Tilt 3D + parallax por capas ---------- */
function attachTilt(card){
  const layer = card.querySelector('.layer');
  let tx=0, ty=0, rx=0, ry=0, trx=0, tryy=0;
  const MAX = 16; // grados

  function setTargetFromPointer(e){
    const rect = card.getBoundingClientRect();
    const cx = (e.clientX ?? e.touches?.[0].clientX) - rect.left;
    const cy = (e.clientY ?? e.touches?.[0].clientY) - rect.top;
    const nx = (cx/rect.width)*2 - 1;   // -1..1
    const ny = (cy/rect.height)*2 - 1;
    ry = -nx * MAX;  // girar sobre Y
    rx =  ny * MAX;  // girar sobre X
    tx = nx * 26;    // parallax X (px)
    ty = ny * 18;    // parallax Y (px)
  }
  function reset(){ rx=ry=tx=ty=0; }

  card.addEventListener('pointermove', setTargetFromPointer);
  card.addEventListener('pointerleave', reset);
  card.addEventListener('pointerdown', setTargetFromPointer);

  // Suavizado con “spring”
  function animate(){
    trx += (tx - trx)*0.12;
    tryy += (ty - tryy)*0.12;
    const srx = parseFloat(card.dataset.rx||0) + (rx - (parseFloat(card.dataset.rx||0)))*0.12;
    const sry = parseFloat(card.dataset.ry||0) + (ry - (parseFloat(card.dataset.ry||0)))*0.12;
    card.dataset.rx = srx; card.dataset.ry = sry;

    card.style.transform = `rotateX(${srx}deg) rotateY(${sry}deg)`;
    layer.style.transform = `translate3d(${trx}px, ${tryy}px, 0)`;
    requestAnimationFrame(animate);
  }
  animate();

  // Tilteo por giroscopio en móviles (si disponible)
  window.addEventListener('deviceorientation', (e)=>{
    if(e.beta==null||e.gamma==null) return;
    const nx = Math.max(-1, Math.min(1, e.gamma/45));  // -45..45 → -1..1
    const ny = Math.max(-1, Math.min(1, e.beta/45 ));
    ry = -nx*MAX; rx = ny*MAX; tx = nx*26; ty = ny*18;
  }, {passive:true});
}

/* posición inicial centrando “Visión” */
window.addEventListener('load', ()=>{
  const start = unit()*(slides.length + 0); // arranca en la 1ª del bloque central
  setX(start);
});
</script>
</body>
</html>
