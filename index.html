<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>SMOOTHY · Sentidos</title>
<style>
  :root{ --bg:#0b0d10; --panel:#12141a; --ink:#eaeef3; --muted:#a9b1bd; }
  *{box-sizing:border-box} html,body{height:100%}
  body{
    margin:0; color:var(--ink);
    font:16px/1.45 Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
    background:
      radial-gradient(1200px 600px at 50% -30%, #1b1f27 0%, transparent 60%),
      radial-gradient(800px 400px at 10% 120%, #111420 0%, transparent 60%),
      var(--bg);
    overflow:hidden;
    user-select:none;
  }

  .top{position:fixed; inset:0 0 auto 0; height:64px; display:flex; align-items:center; gap:16px;
       padding:0 clamp(16px,5vw,32px); background:linear-gradient(180deg, rgba(7,8,10,.85), rgba(7,8,10,0));
       backdrop-filter: blur(6px); z-index:5}
  .logo{font-weight:800; letter-spacing:.06em; font-size:20px}
  .hint{color:var(--muted); font-size:14px}

  .stage{position:absolute; inset:0; display:flex; place-items:center; padding-top:64px}
  .track{
    width:min(96vw,1400px); margin-inline:auto; display:flex; align-items:center;
    gap:clamp(20px,4vw,48px); overflow:auto; scroll-snap-type:x mandatory;
    -webkit-overflow-scrolling:touch; padding:clamp(16px,3vw,32px);
    cursor:grab;
  }
  .track.grabbing{cursor:grabbing}
  .track::-webkit-scrollbar{height:10px} .track::-webkit-scrollbar-thumb{background:#2a2f38; border-radius:8px}

  .card{
    flex:0 0 auto; width:clamp(260px,28vw,420px); height:clamp(360px,60vh,620px);
    border-radius:28px; background:var(--panel); overflow:hidden; scroll-snap-align:center;
    box-shadow:inset 0 1px 0 rgba(255,255,255,.03), 0 30px 60px rgba(0,0,0,.55);
    perspective:1000px; transform:translateZ(0); isolation:isolate; position:relative;
  }
  .card__inner{width:100%; height:100%; transform-style:preserve-3d; will-change:transform}
  .num{position:absolute; top:18px; left:24px; z-index:4; font:12px ui-monospace,Menlo,Consolas,monospace; letter-spacing:.35em; color:#9aa3b3; opacity:.4;}

  .layer{position:absolute; inset:-6% -6%; transform-style:preserve-3d}
  .layer img{position:absolute; inset:0; margin:auto; width:100%; height:100%; object-fit:cover; pointer-events:none; filter:saturate(1.05)}
  .layer.bg{z-index:1}
  .layer.fg{z-index:3}

  /* fg más grande y cerca; bg un poco mayor y lejos */
  .layer.bg img{transform: translateZ(-24px) scale(1.08)}
  .layer.fg img{transform: translateZ(48px)  scale(1.22)}

  .glow{position:absolute; inset:-30% -10%; z-index:2; pointer-events:none;
        background:radial-gradient(600px 380px at 50% 62%, rgba(255,88,185,.18), rgba(140,174,255,.10) 40%, rgba(0,0,0,0) 70%);
        mix-blend-mode:screen; transform:translateZ(10px)}

  .caption{
    position:absolute; left:50%; bottom:18px; translate:-50% 0; z-index:5;
    padding:.44rem .8rem; border-radius:999px; font-weight:600; font-size:14px;
    background:rgba(255,255,255,.06); backdrop-filter:blur(6px);
    box-shadow:0 8px 24px rgba(0,0,0,.35), inset 0 1px 0 rgba(255,255,255,.06);
  }

  .arrows{position:fixed; right:18px; bottom:18px; display:flex; gap:10px; z-index:6}
  .btn{width:42px; height:42px; display:grid; place-items:center; border-radius:50%; color:#dbe0e8;
       background:#141821; box-shadow:0 10px 24px rgba(0,0,0,.45), inset 0 1px 0 rgba(255,255,255,.05);
       border:1px solid #2a2f38; cursor:pointer}
  .btn:active{transform:translateY(1px)} svg{width:18px; height:18px}

  .dots{position:fixed; left:50%; bottom:18px; translate:-50% 0; display:flex; gap:10px; z-index:6}
  .dot{width:8px; height:8px; border-radius:50%; background:#3b4351} .dot.active{background:#fff}

  @media (max-width:640px){ .card{ width:80vw; height:min(68vh,560px)} }
</style>
</head>
<body>
<header class="top">
  <div class="logo">SMOOTHY</div>
  <div class="hint">Arrastra / usa las flechas → Inercia + loop + tilt 3D + parallax</div>
</header>

<main class="stage"><div id="track" class="track" aria-label="Carrusel"></div></main>
<div class="arrows">
  <button class="btn" id="prev" aria-label="Anterior"><svg viewBox="0 0 24 24" fill="none"><path d="M15 6l-6 6 6 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></button>
  <button class="btn" id="next" aria-label="Siguiente"><svg viewBox="0 0 24 24" fill="none"><path d="M9 6l6 6-6 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></button>
</div>
<div id="dots" class="dots" role="tablist"></div>

<script>
/* ----------------- Config rápida ----------------- */
const CFG = {
  tiltMaxX : 10,       // grados por posición vertical del puntero (rotX)
  tiltMaxY : 18,       // grados por velocidad de arrastre (rotY)
  parallax : 22,       // píxeles base de parallax
  inertia  : 0.94,     // fricción al “soltar” el drag
  velK     : 0.25      // factor que convierte velocidad -> tiltY
};

/* ----------------- Datos ----------------- */
const slides = [
  {key:'vision',      title:'Visión'},
  {key:'escucha',     title:'Escucha'},
  {key:'olfato',      title:'Olfato'},
  {key:'sabor',       title:'Sabor'},
  {key:'tacto',       title:'Tacto'},
  {key:'equilibrio',  title:'Equilibrio'}
];

const $track = document.getElementById('track');
const $dots  = document.getElementById('dots');

/* ----------------- Plantar tarjetas ----------------- */
slides.forEach((s,i)=>{
  const card  = el('article','card'); card.setAttribute('role','group');
  const inner = el('div','card__inner');
  const num   = el('div','num',String(i+1).padStart(4,'0'));

  const bg = el('div','layer bg');  const bgImg = img(`assets/${s.key}-mid.png`, `${s.title} fondo`); bg.append(bgImg);
  const fg = el('div','layer fg');  const fgImg = img(`assets/${s.key}-fg.png`,  `${s.title} primer plano`);
  fgImg.addEventListener('error', ()=>{ fgImg.src = `assets/${s.key}-mid.png`; }); fg.append(fgImg);

  const glow = el('div','glow');
  const cap  = el('div','caption',s.title);

  inner.append(num, bg, glow, fg, cap);
  card.append(inner);
  $track.append(card);

  const dot = el('div','dot'+(i===0?' active':'')); dot.onclick=()=>scrollToIndex(i); $dots.append(dot);
});
const cards = [...document.querySelectorAll('.card')];
const dots  = [...document.querySelectorAll('.dot')];

/* ----------------- Drag con inercia + tilt por velocidad ----------------- */
let isDown=false, startX=0, scrollStart=0, vX=0, lastX=0, rafInertia=null;
const pointerY = {val:0.5}; // 0..1

$track.addEventListener('pointerdown', e=>{
  isDown=true; $track.classList.add('grabbing');
  startX=e.clientX; scrollStart=$track.scrollLeft; vX=0; lastX=e.clientX;
  cancelAnimationFrame(rafInertia);
});
window.addEventListener('pointermove', e=>{
  pointerY.val = clamp((e.clientY - $track.getBoundingClientRect().top)/$track.clientHeight,0,1);
  if(!isDown) return;
  const dx = e.clientX - startX;
  $track.scrollLeft = scrollStart - dx;
  vX = e.clientX - lastX; lastX = e.clientX;
});
window.addEventListener('pointerup', ()=>{
  if(!isDown) return; isDown=false; $track.classList.remove('grabbing');
  // inercia
  function tick(){
    vX *= CFG.inertia;
    if(Math.abs(vX) < .2){ vX=0; cancelAnimationFrame(rafInertia); rafInertia=null; return; }
    $track.scrollLeft -= vX;
    rafInertia = requestAnimationFrame(tick);
  }
  rafInertia = requestAnimationFrame(tick);
});

/* ----------------- Animación (aplica tilt/parallax a TODAS las tarjetas) ----------------- */
let raf = null;
function animate(){
  const velTilt = clamp(-(vX*CFG.velK), -CFG.tiltMaxY, CFG.tiltMaxY); // rotY por velocidad
  const rotX = (pointerY.val-.5)*CFG.tiltMaxX;                         // rotX por puntero
  const px = vX;                                                       // parallax horizontal base

  cards.forEach(c=>{
    const inner = c.firstElementChild;
    const fgImg = c.querySelector('.layer.fg img');
    const bgImg = c.querySelector('.layer.bg img');

    inner.style.transform = `rotateX(${rotX}deg) rotateY(${velTilt}deg)`;

    // fg acompaña + desplazamiento; bg contrario y menor
    fgImg.style.transform = `translateZ(48px) scale(1.22) translate(${px*1.1}px, ${(pointerY.val-.5)*CFG.parallax*1.2}px)`;
    bgImg.style.transform = `translateZ(-24px) scale(1.08) translate(${-px*.55}px, ${(0.5-pointerY.val)*CFG.parallax*.8}px)`;
  });

  raf = requestAnimationFrame(animate);
}
raf = requestAnimationFrame(animate);

/* ----------------- Navegación extra ----------------- */
function activeIndex(){
  const mid = $track.scrollLeft + $track.clientWidth/2;
  let idx=0, best=1e9;
  cards.forEach((c,i)=>{const cx=c.offsetLeft+c.offsetWidth/2; const d=Math.abs(cx-mid); if(d<best){best=d; idx=i;}});
  return idx;
}
function setDot(i){ dots.forEach((d,j)=>d.classList.toggle('active', j===i)); }
function scrollToIndex(i){
  const c=cards[i]; const x=c.offsetLeft - ($track.clientWidth - c.offsetWidth)/2;
  $track.scrollTo({left:x, behavior:'smooth'}); setDot(i);
}
document.getElementById('prev').onclick=()=>{let i=activeIndex()-1; if(i<0)i=cards.length-1; scrollToIndex(i);};
document.getElementById('next').onclick=()=>{let i=activeIndex()+1; if(i>cards.length-1)i=0; scrollToIndex(i);};
$track.addEventListener('scroll', ()=>{ clearTimeout($track._t); $track._t=setTimeout(()=>setDot(activeIndex()),60);});

/* ----------------- helpers ----------------- */
function el(tag, cls, txt){ const n=document.createElement(tag); if(cls)n.className=cls; if(txt)n.textContent=txt; return n; }
function img(src, alt){ const i=new Image(); i.decoding='async'; i.loading='eager'; i.src=src; i.alt=alt; return i; }
function clamp(v, a, b){ return Math.max(a, Math.min(b, v)); }
</script>
</body>
</html>
